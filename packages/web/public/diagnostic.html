<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>í† ìŠ¤í˜ì´ë¨¼ì¸  SDK ì§„ë‹¨ ë„êµ¬</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        padding: 30px;
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 24px;
      }
      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }
      .test-section {
        margin-bottom: 25px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }
      .test-section h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 16px;
      }
      .result {
        padding: 12px;
        border-radius: 6px;
        margin-top: 10px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        margin-right: 10px;
        margin-top: 10px;
        transition: background 0.2s;
      }
      button:hover {
        background: #5568d3;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .status-icon {
        display: inline-block;
        width: 20px;
        height: 20px;
        margin-right: 8px;
        vertical-align: middle;
      }
      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” í† ìŠ¤í˜ì´ë¨¼ì¸  SDK ì§„ë‹¨ ë„êµ¬</h1>
      <p class="subtitle">ê²°ì œìœ„ì ¯ ì—°ë™ ë¬¸ì œë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤</p>

      <div class="test-section">
        <h3>1. npm íŒ¨í‚¤ì§€ í™•ì¸</h3>
        <button onclick="testPackage()">íŒ¨í‚¤ì§€ í…ŒìŠ¤íŠ¸</button>
        <div id="package-result"></div>
      </div>

      <div class="test-section">
        <h3>2. SDK ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testSDK()">SDK í…ŒìŠ¤íŠ¸</button>
        <div id="sdk-result"></div>
      </div>

      <div class="test-section">
        <h3>3. ìœ„ì ¯ ë Œë”ë§ í…ŒìŠ¤íŠ¸</h3>
        <div id="test-payment-area" style="min-height: 200px; background: white; border: 2px dashed #ddd; border-radius: 8px; margin: 10px 0;"></div>
        <button onclick="testWidget()">ìœ„ì ¯ ë Œë”ë§</button>
        <div id="widget-result"></div>
      </div>

      <div class="test-section">
        <h3>4. í™˜ê²½ ì •ë³´</h3>
        <div id="env-info" class="result info"></div>
      </div>

      <div class="test-section">
        <h3>5. ì¢…í•© ì§„ë‹¨</h3>
        <button onclick="runFullDiagnostic()">ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        <div id="diagnostic-result"></div>
      </div>
    </div>

    <script type="module">
      // í™˜ê²½ ì •ë³´ í‘œì‹œ
      document.getElementById('env-info').textContent = `
ë¸Œë¼ìš°ì €: ${navigator.userAgent}
ì–¸ì–´: ${navigator.language}
í™”ë©´ í¬ê¸°: ${window.innerWidth}x${window.innerHeight}
í˜„ì¬ URL: ${window.location.href}
      `.trim();

      // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
      window.testPackage = testPackage;
      window.testSDK = testSDK;
      window.testWidget = testWidget;
      window.runFullDiagnostic = runFullDiagnostic;

      async function testPackage() {
        const resultDiv = document.getElementById('package-result');
        resultDiv.innerHTML = '<div class="result info"><span class="loading"></span> íŒ¨í‚¤ì§€ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</div>';

        try {
          const { loadPaymentWidget } = await import('@tosspayments/payment-widget-sdk');

          if (typeof loadPaymentWidget === 'function') {
            resultDiv.innerHTML = '<div class="result success">âœ… @tosspayments/payment-widget-sdk íŒ¨í‚¤ì§€ ë¡œë“œ ì„±ê³µ</div>';
            return true;
          } else {
            throw new Error('loadPaymentWidgetì´ í•¨ìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤');
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="result error">âŒ íŒ¨í‚¤ì§€ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
          return false;
        }
      }

      async function testSDK() {
        const resultDiv = document.getElementById('sdk-result');
        resultDiv.innerHTML = '<div class="result info"><span class="loading"></span> SDKë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘...</div>';

        try {
          const { loadPaymentWidget } = await import('@tosspayments/payment-widget-sdk');

          const clientKey = 'test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm';
          const customerKey = 'diagnostic_test_' + Date.now();

          const widget = await loadPaymentWidget(clientKey, customerKey);

          resultDiv.innerHTML = `<div class="result success">âœ… SDK ì´ˆê¸°í™” ì„±ê³µ
í´ë¼ì´ì–¸íŠ¸ í‚¤: ${clientKey}
Customer Key: ${customerKey}
ìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤: ${typeof widget}</div>`;

          window.testWidgetInstance = widget;
          return widget;
        } catch (error) {
          resultDiv.innerHTML = `<div class="result error">âŒ SDK ì´ˆê¸°í™” ì‹¤íŒ¨
ì—ëŸ¬: ${error.message}
ìŠ¤íƒ: ${error.stack}</div>`;
          return null;
        }
      }

      async function testWidget() {
        const resultDiv = document.getElementById('widget-result');
        resultDiv.innerHTML = '<div class="result info"><span class="loading"></span> ìœ„ì ¯ì„ ë Œë”ë§í•˜ëŠ” ì¤‘...</div>';

        try {
          let widget = window.testWidgetInstance;

          if (!widget) {
            resultDiv.innerHTML = '<div class="result warning">âš ï¸ ë¨¼ì € "SDK í…ŒìŠ¤íŠ¸"ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”</div>';
            return;
          }

          // ê¸ˆì•¡ ì„¤ì •
          await widget.setAmount({
            currency: "KRW",
            value: 50000,
          });

          // ìœ„ì ¯ ë Œë”ë§
          await widget.renderPaymentMethods({
            selector: "#test-payment-area",
            variantKey: "DEFAULT",
          });

          resultDiv.innerHTML = `<div class="result success">âœ… ìœ„ì ¯ ë Œë”ë§ ì„±ê³µ
ê¸ˆì•¡: â‚©50,000
Selector: #test-payment-area
ìœ„ ë°•ìŠ¤ì— ê²°ì œ ìˆ˜ë‹¨ì´ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</div>`;
        } catch (error) {
          resultDiv.innerHTML = `<div class="result error">âŒ ìœ„ì ¯ ë Œë”ë§ ì‹¤íŒ¨
ì—ëŸ¬: ${error.message}
ìŠ¤íƒ: ${error.stack}</div>`;
        }
      }

      async function runFullDiagnostic() {
        const resultDiv = document.getElementById('diagnostic-result');
        resultDiv.innerHTML = '<div class="result info"><span class="loading"></span> ì „ì²´ ì§„ë‹¨ì„ ì‹¤í–‰í•˜ëŠ” ì¤‘...</div>';

        const results = [];

        // 1. íŒ¨í‚¤ì§€ í…ŒìŠ¤íŠ¸
        const packageOk = await testPackage();
        results.push({ name: 'íŒ¨í‚¤ì§€', ok: packageOk });

        // ëŒ€ê¸°
        await new Promise(resolve => setTimeout(resolve, 1000));

        // 2. SDK í…ŒìŠ¤íŠ¸
        const sdkOk = await testSDK();
        results.push({ name: 'SDK', ok: !!sdkOk });

        // ëŒ€ê¸°
        await new Promise(resolve => setTimeout(resolve, 1000));

        // 3. ìœ„ì ¯ í…ŒìŠ¤íŠ¸
        if (sdkOk) {
          try {
            await testWidget();
            results.push({ name: 'ìœ„ì ¯', ok: true });
          } catch (error) {
            results.push({ name: 'ìœ„ì ¯', ok: false });
          }
        } else {
          results.push({ name: 'ìœ„ì ¯', ok: false, skip: true });
        }

        // ê²°ê³¼ ìš”ì•½
        const allOk = results.every(r => r.ok);
        const summary = results.map(r =>
          r.skip ? `âŠ˜ ${r.name}: ê±´ë„ˆëœ€` :
          r.ok ? `âœ… ${r.name}: ì •ìƒ` : `âŒ ${r.name}: ì‹¤íŒ¨`
        ).join('\n');

        if (allOk) {
          resultDiv.innerHTML = `<div class="result success">
ğŸ‰ ëª¨ë“  ì§„ë‹¨ í†µê³¼!

${summary}

ê²°ì œìœ„ì ¯ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
React ì•±ì—ì„œë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.
</div>`;
        } else {
          resultDiv.innerHTML = `<div class="result error">
âš ï¸ ì¼ë¶€ ì§„ë‹¨ ì‹¤íŒ¨

${summary}

ì‹¤íŒ¨í•œ í•­ëª©ì„ í™•ì¸í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì„¸ìš”.
TROUBLESHOOTING.md íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.
</div>`;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
      window.addEventListener('load', () => {
        console.log('ì§„ë‹¨ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
      });
    </script>
  </body>
</html>
